<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC项目</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div id="wrapper">
        <!-- 头部 -->
        <div id="header">
            <!-- 头部导航栏 -->
            <div class="header-nav">
                <div class="header-nav-con">
                    <!-- 头部导航栏左侧 -->
                    <div class="header-nav-con-left">
                        <p>尚品汇欢迎您!</p>
                        <p>请<a href="javascript:;">登录</a><a href="javascript:;">免费注册</a></p>
                    </div>
                    <!-- 头部导航栏右侧 -->
                    <div class="header-nav-con-right">
                        <a href="javascript:;">我的订单</a>
                        <a href="javascript:;">我的购物车</a>
                        <a href="javascript:;">我的尚品汇</a>
                        <a href="javascript:;">尚品汇会员</a>
                        <a href="javascript:;">企业采购</a>
                        <a href="javascript:;">关注尚品汇</a>
                        <a href="javascript:;">合作招聘</a>
                        <a href="javascript:;">商家后台</a>
                    </div>
                </div>
            </div>
            <!-- logo栏 -->
            <div class="header-logo">
                <!-- logo -->
                <h2 class="header-logo-left">
                    <a href="javascript:;">
                        <img src="./images/logo.png">
                    </a>
                </h2>

                <!-- 搜索框 -->
                <div class="header-logo-right">
                    <input type="text">
                    <button>搜索</button>
                </div>
            </div>
        </div>
        <!-- 所有商品分类 -->
        <div id="all-goods">
            <div class="goods">
                <p>
                    所有商品分类
                </p>
                <div class="items">
                    <a href="javascript:;">服装城</a>
                    <a href="javascript:;">美妆馆</a>
                    <a href="javascript:;">尚品汇超市</a>
                    <a href="javascript:;">全球购</a>
                    <a href="javascript:;">闪购</a>
                    <a href="javascript:;">团购</a>
                    <a href="javascript:;">有趣</a>
                    <a href="javascript:;">秒杀</a>
                </div>
            </div>
        </div>
        <!-- 放大镜栏 -->
        <div id="enlarge">
            <!-- 放大镜栏的导航 -->
            <div class="nav">
                <a href="javascript:;">手机、数码、通讯手机</a>
                <a href="javascript:;">Apple苹果</a>
                <a href="javascript:;">iphone 6S系类</a>
            </div>
            <!-- 放大镜栏的具体内容 -->
            <div class="main-con">

                <!-- 主要内容的左侧 -->
                <div class="main-con-left">
                    <!-- 原本的图片 -->
                    <div class="pic-before">
                        <img src="./images/s1.png">
                        <!-- 蒙版 -->
                        <!-- <div class="pic-mask"></div> -->
                        <!-- 放大之后 -->
                        <!-- <div class="pic-after"></div> -->
                    </div>


                    <!-- 缩略图点击轮播 -->
                    <div class="pic-move">
                        <!-- 左边按钮 -->
                        <p class="left">&lt;</p>
                        <!-- 中间图片 -->
                        <div class="pic-list">
                            <ul class="list">
                                <!-- <li>
                                    <img src="./images/s1.png">
                                </li>
                                <li>
                                    <img src="./images/s2.png">
                                </li>
                                <li>
                                    <img src="./images/s3.png">
                                </li>
                                <li>
                                    <img src="./images/s1.png">
                                </li>
                                <li>
                                    <img src="./images/s2.png">
                                </li>
                                <li>
                                    <img src="./images/s3.png">
                                </li>
                                <li>
                                    <img src="./images/s1.png">
                                </li>
                                <li>
                                    <img src="./images/s2.png">
                                </li>
                                <li>
                                    <img src="./images/s3.png">
                                </li>
                                <li>
                                    <img src="./images/s1.png">
                                </li>
                                <li>
                                    <img src="./images/s2.png">
                                </li>
                                <li>
                                    <img src="./images/s3.png">
                                </li>  -->
                            </ul>
                        </div>
                        <!-- 右边按钮 -->
                        <p class="right">&gt;</p>
                    </div>
                </div>
                <!-- 放大镜一栏中主要内容的右侧 -->
                <div class="main-con-right">
                    <div class="otherGoodsDetail"></div>
                    <!-- 商品具体标题 -->
                    <!-- <h3>Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3> -->
                    <!-- 优惠方式 -->
                    <!-- <p>推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返</p> -->
                    <!-- 粉红背景区 -->
                    <!-- 具体价格 -->
                    <!-- <div class="priceDetail"> -->
                        <!-- 价格 -->
                        <!-- <div class="price">
                            <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                            <p>￥<strong>5299</strong>元</p>
                        </div> -->
                        <!-- 促销 -->
                        <!-- <div class="sales">
                            <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                            <p><span>加价购</span>满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</p>
                        </div>
                    </div> -->
                    <!-- 支持区域包含两个内容 -->
                    <!-- <div class="supportArea"> -->
                        <!-- 支持 -->
                        <!-- <div class="support">
                            <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                            <p>以旧换新，闲置手机回收 4G套餐超值抢 礼品购</p>
                        </div> -->
                        <!-- 配送至 -->
                        <!-- <div class="send">
                            <p>配&nbsp;送&nbsp;至</p>
                            <p>广东省 深圳市 宝安区</p>
                        </div>
                    </div> -->
                    <div class="chooseDetail"></div>
                    <!-- 商品具体细节 -->
                    <div class="goodDetail">
                        <!-- <dl>
                            <dt>选择颜色</dt>
                            <dd>金色</dd>
                            <dd>银色</dd>
                            <dd>黑色</dd>
                        </dl>
                        <dl>
                            <dt>内存容量</dt>
                            <dd>16G</dd>
                            <dd>32G</dd>
                            <dd>64G</dd>
                            <dd>128G</dd>
                        </dl>
                        <dl>
                            <dt>选择版本</dt>
                            <dd>公开版</dd>
                            <dd>移动版</dd>
                        </dl>
                        <dl>
                            <dt>选择优惠</dt>
                            <dd>官方标配</dd>
                            <dd>移动优惠版</dd>
                            <dd>电信优惠版</dd>
                        </dl> -->
                    </div>
                    <!-- 添加商品至购物车 -->
                    <div class="cart">
                        <div class="goodNum">
                            <input type="text" value="1">
                            <button class="plus">+</button>
                            <button class="mins">-</button>
                        </div>

                        <p>加入购物车</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- 在全局引入数据 -->
    <script src="./js/data.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            //全局变量保存缩略图中点击的是第几张,默认为第0张
            var thumbnailIndex = 0;
            //商品数量,默认为1
            var goodsNum = 1;
            //获取数据对象
            var oImgSrc = goodData.imgSrc;

            //4.动态加载缩略图数据
            thumbnailData();
            function thumbnailData() {
                //获取要添加进去的位置的父级元素对象
                var oPicList = document.querySelector(".pic-list .list");
                // 循环创建新的节点
                for (var i = 0; i < oImgSrc.length; i++) {
                    //创建新的li节点
                    var oLi = document.createElement("li");
                    //创建新的img节点
                    var oImg = document.createElement("img");
                    //给节点添加src属性
                    oImg.setAttribute("src", oImgSrc[i].s);
                    //把图片添加到li中
                    oLi.appendChild(oImg);
                    //把li添加到ul中
                    oPicList.appendChild(oLi);
                }
            }
            //6.动态加载dd数据
            dlAndDdData();
            function dlAndDdData() {
                //获取数据对象,这个获取到的对象是一个数组
                var DlDdData = goodData.goodsDetail.crumbData;
                var oGoodDetail = document.querySelector(".goodDetail");
                // console.log(dlDdData);
                //遍历数组创建元素
                DlDdData.forEach(function (item) {
                    //创建dl
                    var newDl = document.createElement("dl");
                    //创建dt
                    var newDt = document.createElement("dt");
                    //给dt添加内容
                    newDt.innerHTML = item.title;
                    //将dt添加到父元素中
                    newDl.appendChild(newDt);
                    //遍历创建dd
                    item.data.forEach(function (item) {

                        //创建dd
                        var newDd = document.createElement("dd");
                        newDd.innerHTML = item.type;
                        //给每一个dd添加一个自定义属性用于改变价格
                        newDd.dataset.changePrice = item.changePrice;
                        console.log(newDd)
                        //将dd添加到父元素中
                        newDl.appendChild(newDd);
                    })
                    //把dl添加到父元素中
                    oGoodDetail.appendChild(newDl);
                })
            }
            //8.动态加载商品详情信息
            otherGoodsDetail();
            function otherGoodsDetail(){
                //获取数据
                var otherDetail = goodData.goodsDetail;
                //获取要添加字符串位置的父元素对象
                var oOtherDetail = document.querySelector(".otherGoodsDetail");
                //定义变量保存字符串
                var str = `
                <!-- 商品具体标题 -->
                    <h3>${goodData.goodsDetail.title}</h3>
                    <!-- 优惠方式 -->
                    <p>${goodData.goodsDetail.recommend}</p>
                    <!-- 粉红背景区 -->
                    <div class="priceDetail">
                <!-- 价格 -->
                        <div class="price">
                            <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                            <p>￥<strong>${goodData.goodsDetail.price}</strong>元</p>
                        </div>
                        <!-- 促销 -->
                        <div class="sales">
                            <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                            <p><span>${goodData.goodsDetail.promoteSales.type}</span>${goodData.goodsDetail.promoteSales.content}</p>
                        </div>
                    </div>
                    <!-- 支持区域包含两个内容 -->
                    <div class="supportArea">
                        <!-- 支持 -->
                        <div class="support">
                            <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                            <p>${goodData.goodsDetail.support}</p>
                        </div>
                        <!-- 配送至 -->
                        <div class="send">
                            <p>配&nbsp;送&nbsp;至</p>
                            <p>${goodData.goodsDetail.address}</p>
                        </div>
                
                `
                // 把字符串写入标签中
                oOtherDetail.innerHTML = str;
            }
            // 调用放大镜
            magnifier();
            //1.封装函数,实现放大镜
            function magnifier() {
                //获取元素对象
                var oPicBefore = document.querySelector(".pic-before");

                var oMask = null;
                var oBigArea = null;
                var oImgBigArea = null;
                //鼠标移入事件,移入后创建蒙版
                oPicBefore.onmouseenter = function () {
                    //创建蒙版
                    var oMask = document.createElement("div");
                    //给蒙版添加样式
                    oMask.classList.add("pic-mask");
                    //把创建的蒙版添加到区域中
                    oPicBefore.appendChild(oMask);

                    //创建大图区域
                    var oBigArea = document.createElement("div");
                    //给大图区域添加样式
                    oBigArea.classList.add("pic-after");
                    //在大图中添加图片标签
                    var oImgBigArea = document.createElement("img");
                    oImgBigArea.classList.add("pic-after-img");
                    //添加图片路径
                    oImgBigArea.setAttribute("src", oImgSrc[thumbnailIndex].b);
                    //把图片添加大大图区域
                    oBigArea.appendChild(oImgBigArea);
                    //把创建的大图添加到区域中
                    oPicBefore.appendChild(oBigArea);




                    //大图可以走的长度
                    var oBigCanMove = {
                        x: oBigArea.clientWidth - oImgBigArea.offsetWidth,
                        y: oBigArea.clientHeight - oImgBigArea.offsetHeight
                    }
                    //蒙版可以走的长度
                    var oMaskMove = {
                        x: oPicBefore.clientWidth - oMask.offsetWidth,
                        y: oPicBefore.clientHeight - oMask.offsetHeight
                    }
                    //求比例
                    //大图可以走的长度/小图可以走的长度
                    var scale = {
                        x: oBigCanMove.x / oMaskMove.x,
                        y: oBigCanMove.y / oMaskMove.y
                    }
                    //鼠标移动事件,鼠标移动时改变蒙版的定位
                    oPicBefore.onmousemove = function (e) {
                        //鼠标到浏览器窗口的距离 - 放大镜区域到浏览器窗口的距离
                        var mouseToBro = {
                            x: e.clientX - oPicBefore.getBoundingClientRect().left,
                            y: e.clientY - oPicBefore.getBoundingClientRect().top
                        }
                        //获取鼠标与蒙版边缘的距离
                        var mouseToMask = {
                            x: oMask.offsetWidth / 2,
                            y: oMask.offsetHeight / 2
                        }
                        //蒙版定位
                        var positionMask = {
                            x: mouseToBro.x - mouseToMask.x,
                            y: mouseToBro.y - mouseToMask.y
                        }
                        // 判断临界值
                        if (positionMask.x >= oPicBefore.offsetWidth - oMask.offsetWidth) {
                            positionMask.x = oPicBefore.offsetWidth - oMask.offsetWidth
                        } else if (positionMask.x < 0) {
                            positionMask.x = 0;
                        }
                        if (positionMask.y >= oPicBefore.offsetHeight - oMask.offsetHeight) {
                            positionMask.y = oPicBefore.offsetHeight - oMask.offsetHeight
                        } else if (positionMask.y < 0) {
                            positionMask.y = 0;
                        }


                        //给蒙版定位
                        oMask.style.left = positionMask.x + "px";
                        oMask.style.top = positionMask.y + "px";
                        //给大图中的图片定位
                        oImgBigArea.style.left = (scale.x * positionMask.x) + "px";
                        oImgBigArea.style.top = (scale.y * positionMask.y) + "px";
                    }
                    //鼠标移出事件
                    oPicBefore.onmouseleave = function () {
                        oPicBefore.removeChild(oMask);
                        oPicBefore.removeChild(oBigArea);
                        oPicBefore.onmousemove = null;
                        oPicBefore.onmouseleave = null;
                        oMask = null;
                        oBigArea = null;
                        oImgBigArea = null;
                    }
                }

            }
            // 调用缩略图
            thumbnail();
            //2.缩略图移动
            function thumbnail() {
                //获取元素对象
                // var oPicList = document.querySelector(".pic-list");
                var oPicListUl = document.querySelector(".pic-list .list");
                var oPicListUlLis = document.querySelectorAll(".pic-list .list li");
                var oPicMoveLeft = document.querySelector(".pic-move .left");
                var oPicMoveRight = document.querySelector(".pic-move .right");

                //缩略图显示部分显示的图片数量(可求出显示部分的宽度)
                var viewLength = 5;
                //缩略图每次移动时走过的图片数量(可求出每次移动的宽度)
                var everyLength = 2;
                //每次移动的长度
                var everyMoveLength = everyLength * oPicListUlLis[0].offsetWidth;
                //总共可以移动的长度
                var allLength = (oPicListUlLis.length - viewLength) * oPicListUlLis[0].offsetWidth;
                //已经走过的长度(一开始为0)
                var alreadyLength = 0;


                //右键点击事件
                oPicMoveRight.onclick = function () {
                    //如果已经走过的长度小于一共可以走的长度,说明还可以再走
                    if (alreadyLength <= allLength) {
                        //如果总共可以走过的长度-已经走过的长度>2个长度,那么可以走两个长度
                        if (allLength - alreadyLength > everyMoveLength) {
                            alreadyLength += everyMoveLength;
                            oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                        }
                        else {
                            // alreadyLength += everyMoveLength / 2;
                            alreadyLength = allLength;
                            oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                        }
                        // oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                    }

                }
                //左键点击事件
                oPicMoveLeft.onclick = function () {
                    //如果已经走过的长度大于0,说明原本已经向右点过了,所以此时点击左边的可以移动
                    if (alreadyLength > 0) {
                        //如果总共可以走过的长度-已经走过的长度>2个长度,那么可以走两个长度
                        if (alreadyLength >= everyMoveLength) {
                            alreadyLength -= everyMoveLength;
                            oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                        }
                        else {
                            alreadyLength -= everyMoveLength / 2;
                            oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                        }
                        // oPicListUl.style.transform = "translate(" + (-alreadyLength) + "px)";
                    }

                }
            }
            thumbnailClick();
            //3.缩略图点击

            function thumbnailClick() {
                //获取要添加进去的位置的父级元素对象
                var oPicListLisImg = document.querySelectorAll(".pic-list .list li img");
                //获取小图区域img
                var oPicBeforeImg = document.querySelector(".pic-before > img");
                //获取大图区域img
                oPicListLisImg.forEach(function (item, index) {
                    // 绑定点击事件
                    item.onclick = function () {
                        //获取它的src属性
                        // var oSrc = this.getAttribute("src");
                        //把这个src赋给小图区域的img
                        oPicBeforeImg.src = item.src;
                        //把这个src赋给大图区域的img
                        // oPicAfterImg.setAttribute("src",oSrc);
                        thumbnailIndex = index;
                    }
                })

            }
            chooseDetail();
            //5.筛选详情
            function chooseDetail() {
                //获取每一项的数据数据
                var dataPrice = goodData.imgSrc;
                //创建一个数组,用于保存被选择的项
                var arr = [0, 0, 0, 0];
                //获取元素对象
                var aGoodDetailDl = document.querySelectorAll(".goodDetail dl");

                //对这组dl进行遍历
                aGoodDetailDl.forEach(function (item, index) {
                    //给每一个dl添加一个index属性
                    item.index = index;
                    //每一个dl获取这组中的dd
                    var aDlDd = item.getElementsByTagName("dd");
                    //默认情况下每组dd中的第一个是红色
                    aDlDd[0].style.color = "red";
                    //遍历每一组dd
                    Array.from(aDlDd).forEach(function (item, index) {
                        //对每一个dd绑定点击事件
                        item.onclick = function () {
                            //清空当前样式
                            Array.from(aDlDd).forEach(function (item, index) {
                                item.style.color = "#666";
                            })
                            //给当前被点击的项一个样式
                            this.style.color = "red";

                            //点完之后再把这一项添加到数组中
                            arr[this.parentNode.index] = this;
                            //获取在html中的布局元素对象
                            var oChooseDetail = document.querySelector(".chooseDetail");
                            //每次遍历之前都清空标签
                            oChooseDetail.innerHTML = "";
                            //遍历数组,把数组中的元素添加到页面标签中
                            arr.forEach(function (item, index) {
                                if (item) {
                                    //创建标签mark
                                    var oMark = document.createElement("mark");
                                    //把数组中的内容写入到新创建的标签中
                                    oMark.innerHTML = item.innerHTML;
                                    //把新创建的标签添加到页面中
                                    oChooseDetail.appendChild(oMark);

                                    //创建一个删除标签
                                    var oDelete = document.createElement("a");
                                    //给a标签定义一个自定义属性,把a所在的dl的下标保存起来
                                    oDelete.dataset.index = index;
                                    oDelete.innerHTML = "  X";
                                    oMark.appendChild(oDelete);
                                }

                            });
                            //删除事件
                            //获取元素对象
                            var aDeletes = document.querySelectorAll("mark a");
                            aDeletes.forEach(function (item, index) {
                                item.onclick = function () {
                                    //删除元素
                                    this.parentNode.parentNode.removeChild(this.parentNode);
                                    //删除数组中的对应元素
                                    arr[item.dataset.index] = 0;

                                    //清空当前所有样式
                                    var oDelDd = aGoodDetailDl[item.dataset.index].getElementsByTagName("dd");
                                    Array.from(oDelDd).forEach(function (item, index) {
                                        item.style.color = "#666";
                                    })
                                    //给第一个默认样式
                                    oDelDd[0].style.color = "red";
                                    //删除以后改变价格
                                    addPrice(arr);
                                }
                            })
                            console.log(arr);
                            //改变价格
                            addPrice(arr);
                        }

                    });
                });
            }

            //7.改变价格
            function addPrice(arr) {
                //获取显示价格的元素对象
                var oPrice = document.querySelector(".priceDetail .price strong");
                //获取原本的价格
                var startPrice = goodData.goodsDetail.price;
                var changPrice = 0;
                //遍历数组,得到数组中每一个元素的自定义属性的值
                arr.forEach(function (item) {
                    if (item) {
                        changPrice += parseInt(item.dataset.changePrice);
                    }
                })
                startPrice += changPrice ;
                oPrice.innerHTML = startPrice * goodsNum;
            }
            //8.改变数量
            changeGoodsNum();
            function changeGoodsNum(){
                //获取文本对象
                var oGoodsNumInput = document.querySelector(".goodNum input");
                //获取页面中原本显示的价格
                var oPrice = document.querySelector(".priceDetail .price strong");
                var oPlus = document.querySelector(".goodNum .plus");
                var oMins = document.querySelector(".goodNum .mins");
                oGoodsNumInput.value = goodsNum;
                //加号按钮点击事件
                oPlus.onclick = function(){
                    goodsNum++;
                    oGoodsNumInput.value = goodsNum;
                    oPrice.innerHTML = +(oPrice.innerHTML) / (goodsNum - 1) * goodsNum;
                }
                //减号按钮点击事件
                oMins.onclick = function(){
                    goodsNum--;
                    if(goodsNum < 1){
                        goodsNum = 1;
                        return;
                    }
                    oGoodsNumInput.value = goodsNum;
                    oPrice.innerHTML = +(oPrice.innerHTML) / (goodsNum + 1) * goodsNum;
                }

            }
        })
    </script>
</body>

</html>